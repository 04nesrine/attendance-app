<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Universit√© d'Alger 1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="logo.jpeg">
    <script src="https://kit.fontawesome.com/1a892f7f47.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="attendance.css">
    <!-- dans <head> ou juste avant le script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <ul class="nav-ul">
                    <li class="link"><a href="home.html">Home</a></li>
                    <li class="link"><a href="attendance.html">Attendance List</a></li>
                    <li class="link"><a href="add.html">Add Student</a></li>
                    <li class="link"><a href="raport.html">Reports</a></li>
                    <li class="link"><a href="#">Log-out</a></li>
                </ul>
            </nav>        
        </div>          
    </header>

     <h2>-STUDENT ATTENDANCE-</h2>

        <table id="attendanceTable" class="Attendance">
    <thead>
        <tr>
            <th rowspan="2">Student ID</th>
            <th rowspan="2">Last Name</th>
            <th rowspan="2">First Name</th>
            <th colspan="6">Attendance (S1 - S6)</th>
            <th colspan="6">Participation (P1 - P6)</th>
            <th rowspan="2">Absences</th>
            <th rowspan="2">Participations</th>
            <th rowspan="2">Message</th>
        </tr>

        <tr>
            <th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th><th>S6</th>
            <th>P1</th><th>P2</th><th>P3</th><th>P4</th><th>P5</th><th>P6</th>
        </tr>
    </thead>

    <tbody>

        <tr>
            <td>31094731</td>
            <td>Oudina</td>
            <td>Aya Nesrine</td>

            <!-- Attendance checkboxes -->
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>

            <!-- Participation checkboxes -->
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>
            <td><input type="checkbox"></td>

            <td class="abs"></td>
            <td class="part"></td>
            <td class="msg"></td>
        </tr>

        <tr>
            <td>31094732</td>
            <td>Brahimi</td>
            <td>Salim</td>

            <!-- Attendance -->
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>

            <!-- Participation -->
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>

            <td class="abs"></td>
            <td class="part"></td>
            <td class="msg"></td>
        </tr>

        <tr>
            <td>31094733</td>
            <td>Khelifi</td>
            <td>Rym</td>

            <!-- Attendance -->
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>

            <!-- Participation -->
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>
            <td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td>

            <td class="abs"></td>
            <td class="part"></td>
            <td class="msg"></td>
        </tr>

    </tbody>
</table>
        <!-- Boutons et section rapport (mettre o√π tu veux sur la page attendance.html) -->
<div style="text-align:center; margin:12px 0;">
  <button id="showReport">Show Report</button>
  <button id="highlightExcellent">Highlight Excellent Students</button>
  <button id="resetColors">Reset Colors</button>
</div>

<section id="reportSection" style="display:none; margin: 16px auto; width:90%; max-width:800px; background:#fff; padding:12px; border-radius:8px;">
  <div id="reportSummary"></div>
  <canvas id="reportChart" width="400" height="200"></canvas>
</section>

    <footer>
        <div class="footer-container">
            <div class="footer-links">
                <h3>Liens Utiles</h3>
                <ul>
                    <li><a href="#">Accueil</a></li>
                    <li><a href="#">√Ä propos</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h3>R√©seaux Sociaux</h3>
                <ul>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">LinkedIn</a></li>
                </ul>
            </div>
        </div>
    </footer>
   
<script>
// ‚úÖ Calcule absences / participations / messages pour TOUTES les lignes
function calculateAttendance() {
    const rows = document.querySelectorAll("#attendanceTable tbody tr");

    rows.forEach(row => {
        const checkboxes = row.querySelectorAll("input[type='checkbox']");
        if (checkboxes.length < 12) return;

        const attendance = Array.from(checkboxes).slice(0, 6);
        const participation = Array.from(checkboxes).slice(6, 12);

        const abs = 6 - attendance.filter(c => c.checked).length;
        const part = participation.filter(c => c.checked).length;

        row.querySelector(".abs").textContent = abs;
        row.querySelector(".part").textContent = part;

        // üîµ Couleurs
        if (abs < 3) row.style.backgroundColor = "lightgreen";
        else if (abs <= 4) row.style.backgroundColor = "yellow";
        else row.style.backgroundColor = "tomato";

        // üîµ Messages
        let msg = "";
        if (abs >= 5) msg = "Excluded ‚Äì too many absences ‚Äì You need to participate more";
        else if (abs >= 3) msg = "Warning ‚Äì attendance low ‚Äì You need to participate more";
        else if (part >= 4) msg = "Good attendance ‚Äì Excellent participation";
        else msg = "Good attendance ‚Äì Participation acceptable";

        row.querySelector(".msg").textContent = msg;
    });
}

// ================================================
// 1Ô∏è‚É£ Charger les √©tudiants depuis localStorage
// ================================================
document.addEventListener("DOMContentLoaded", () => {
    const table = document.querySelector("#attendanceTable tbody");
    const saved = JSON.parse(localStorage.getItem("students") || "[]");

    saved.forEach(s => addStudentToTable(s));

    calculateAttendance(); // üî• Applique le script aux √©tudiants existants
});

// ================================================
// 2Ô∏è‚É£ Fonction qui ajoute une ligne HTML
// ================================================
function addStudentToTable(student) {
    const table = document.querySelector("#attendanceTable tbody");
    const tr = document.createElement("tr");

    tr.innerHTML = `
        <td>${student.id}</td>
        <td>${student.lastName}</td>
        <td>${student.firstName}</td>

        ${"<td><input type='checkbox'></td>".repeat(6)}
        ${"<td><input type='checkbox'></td>".repeat(6)}

        <td class='abs'></td>
        <td class='part'></td>
        <td class='msg'></td>
    `;

    table.appendChild(tr);
}

// ================================================
// 3Ô∏è‚É£ Quand un √©tudiant est ajout√© dans add.html
// ================================================
window.addEventListener("studentsUpdated", () => {
    const saved = JSON.parse(localStorage.getItem("students") || "[]");
    const last = saved[saved.length - 1];

    addStudentToTable(last);
    calculateAttendance(); // üî• Met le message + couleur + abs pour le nouvel √©tudiant
});

// ================================================
// 4Ô∏è‚É£ Recalculer √† chaque clic sur un checkbox
// ================================================
document.addEventListener("change", (e) => {
    if (e.target.type === "checkbox") {
        calculateAttendance();
    }
});
</script>



<script>
document.addEventListener("DOMContentLoaded", () => {

    function deleteStudent(id, row) {
        let students = JSON.parse(localStorage.getItem("students") || "[]");
        students = students.filter(s => s.id !== id);
        localStorage.setItem("students", JSON.stringify(students));

        row.remove(); // supprime la ligne du tableau
        alert("Student removed successfully");
    }

    // ajoute bouton delete √† chaque ligne existante
    const rows = document.querySelectorAll(".Attendance tbody tr");

    rows.forEach(row => {
        const id = row.cells[0].textContent.trim();
        const td = document.createElement("td");

        td.innerHTML = `<button class="deleteBtn">üóëÔ∏è</button>`;
        row.appendChild(td);

        td.querySelector("button").onclick = () => deleteStudent(id, row);
    });
});
</script>

<script>
// ==========================
// 5Ô∏è‚É£ SHOW REPORT + CHART
// ==========================

document.getElementById("showReport").addEventListener("click", function () {

    const rows = document.querySelectorAll("#attendanceTable tbody tr");

    let total = rows.length;
    let totalPresent = 0;
    let totalParticipated = 0;

    rows.forEach(row => {
        const checkboxes = row.querySelectorAll("input[type='checkbox']");
        const attendance = Array.from(checkboxes).slice(0, 6);
        const participation = Array.from(checkboxes).slice(6, 12);

        totalPresent += attendance.filter(c => c.checked).length;
        totalParticipated += participation.filter(c => c.checked).length;
    });

    document.getElementById("reportSection").style.display = "block";

    document.getElementById("reportSummary").innerHTML = `
        <p><b>Total students:</b> ${total}</p>
        <p><b>Total presence checks:</b> ${totalPresent}</p>
        <p><b>Total participation checks:</b> ${totalParticipated}</p>
    `;

    const ctx = document.getElementById("reportChart").getContext("2d");

    if (window.myChart) window.myChart.destroy();

    window.myChart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Total Students", "Presence", "Participation"],
            datasets: [{
                label: "Attendance Report",
                data: [total, totalPresent, totalParticipated]
            }]
        }
    });
});
</script>
<script>
// ===============
// 6Ô∏è‚É£ HIGHLIGHT + CLICK MESSAGE (jQuery)
// ===============

$(document).ready(function () {

    // survol : highlight
    $("#attendanceTable tbody tr").hover(
        function () { 
            $(this).css("background-color", "#d0e7ff"); 
        },
        function () { 
            calculateAttendance(); // remet la couleur logique
        }
    );

    // clique : afficher infos de l'√©tudiant
    $("#attendanceTable tbody").on("click", "tr", function () {
        let lastName = $(this).find("td:nth-child(2)").text();
        let firstName = $(this).find("td:nth-child(3)").text();
        let absences = $(this).find(".abs").text();

        alert(`Student: ${firstName} ${lastName}\nAbsences: ${absences}`);
    });

});
</script>
<script>
// =============================
// 7Ô∏è‚É£ HIGHLIGHT EXCELLENT STUDENTS (jQuery)
// =============================

$(document).ready(function () {

    // ---- 1) Highlight excellent students ----
    $("#highlightExcellent").click(function () {

        $("#attendanceTable tbody tr").each(function () {
            let abs = parseInt($(this).find(".abs").text()) || 0;

            // √©tudiants excellents : moins de 3 absences
            if (abs < 3) {
                // petite animation : fondu + couleur
                $(this).css("transition", "background-color 0.6s ease");
                $(this).fadeTo(300, 0.4)
                       .fadeTo(300, 1.0)
                       .css("background-color", "#b3ffb3"); // vert clair
            }
        });

    });

    // ---- 2) Reset Color ----
    $("#resetColors").click(function () {
        $("#attendanceTable tbody tr").each(function () {
            $(this).css("background-color", "");
        });

        // remettre les couleurs normales selon les absences
        calculateAttendance();
    });

});
</script>



</body>